<!DOCTYPE html>
<html>
<head>
  <title>MindEase Chat | AI Therapist</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    body { 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }
    
    .sidebar { 
      width: 280px; 
      min-height: 100vh; 
      background: rgba(255, 255, 255, 0.95); 
      backdrop-filter: blur(10px);
      border-right: 1px solid rgba(221, 221, 221, 0.3);
      box-shadow: 2px 0 15px rgba(0,0,0,0.1);
    }
    
    .chat-container {
      display: flex;
      flex-direction: column;
      height: calc(100vh - 120px);
    }
    
    .chat-header {
      background: linear-gradient(to right, #4f6df5, #3a56d5);
      color: white;
      border-radius: 15px 15px 0 0;
      padding: 1.2rem;
    }
    
    .chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 1.5rem;
      background: #f8f9fa;
      scrollbar-width: thin;
    }
    
    .chat-messages::-webkit-scrollbar {
      width: 6px;
    }
    
    .chat-messages::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    
    .chat-messages::-webkit-scrollbar-thumb {
      background: #c1c1c1;
      border-radius: 3px;
    }
    
    .message {
      margin-bottom: 1rem;
      max-width: 75%;
      animation: fadeIn 0.3s ease;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    
    .user-message {
      margin-left: auto;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      border-radius: 15px 15px 0 15px;
      padding: 0.8rem 1.2rem;
    }
    
    .ai-message {
      background: white;
      color: #333;
      border-radius: 15px 15px 15px 0;
      padding: 0.8rem 1.2rem;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
    }
    
    .message-time {
      font-size: 0.75rem;
      opacity: 0.7;
      margin-top: 0.3rem;
      text-align: right;
    }
    
    .ai-indicator {
      display: inline-flex;
      align-items: center;
      background: #e9f5ff;
      padding: 0.3rem 0.8rem;
      border-radius: 20px;
      font-size: 0.85rem;
      color: #4f6df5;
    }
    
    .typing-indicator {
      display: none;
      background: white;
      padding: 0.8rem 1.2rem;
      border-radius: 15px;
      margin-bottom: 1rem;
      width: fit-content;
    }
    
    .typing-dots {
      display: flex;
      gap: 3px;
    }
    
    .typing-dots span {
      width: 8px;
      height: 8px;
      background: #667eea;
      border-radius: 50%;
      animation: typing 1.4s infinite;
    }
    
    .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
    
    @keyframes typing {
      0%, 60%, 100% { transform: translateY(0); }
      30% { transform: translateY(-8px); }
    }
    
    .chat-input-container {
      background: white;
      border-radius: 0 0 15px 15px;
      padding: 1.2rem;
      box-shadow: 0 -2px 10px rgba(0,0,0,0.05);
    }
    
    .quick-responses {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
      flex-wrap: wrap;
    }
    
    .quick-response-btn {
      background: #f0f4ff;
      border: 1px solid #d0d9ff;
      color: #4f6df5;
      border-radius: 20px;
      padding: 0.4rem 1rem;
      font-size: 0.85rem;
      transition: all 0.2s;
    }
    
    .quick-response-btn:hover {
      background: #4f6df5;
      color: white;
      transform: translateY(-1px);
    }
    
    .message-input {
      border-radius: 25px;
      border: 2px solid #e0e0e0;
      padding: 0.8rem 1.5rem;
      font-size: 1rem;
      transition: all 0.3s;
    }
    
    .message-input:focus {
      border-color: #4f6df5;
      box-shadow: 0 0 0 0.25rem rgba(79, 109, 245, 0.25);
    }
    
    .send-btn {
      border-radius: 50%;
      width: 50px;
      height: 50px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border: none;
      transition: all 0.3s;
    }
    
    .send-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }
    
    .mood-indicator {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      background: rgba(255, 255, 255, 0.9);
      padding: 0.5rem 1rem;
      border-radius: 20px;
      margin-bottom: 1rem;
    }
  </style>
</head>

<body>

<div class="d-flex">

  <!-- Enhanced Sidebar -->
  <div class="sidebar p-4">
    <div class="d-flex align-items-center mb-4">
      <div class="rounded-circle bg-primary p-2 me-3">
        <i class="bi bi-heart-fill text-white fs-4"></i>
      </div>
      <h4 class="fw-bold mb-0 text-primary">ðŸ’™ MindEase</h4>
    </div>
    
    <div class="mb-4">
      <div class="mood-indicator">
        <span id="currentMoodEmoji">ðŸ˜Š</span>
        <small id="currentMoodText">Feeling Good</small>
      </div>
    </div>
    
    <ul class="nav flex-column">
      <li class="nav-item mb-3">
        <a class="nav-link text-dark d-flex align-items-center" href="dashboard.html">
          <i class="bi bi-grid me-3"></i> Dashboard
        </a>
      </li>
      <li class="nav-item mb-3">
        <a class="nav-link fw-bold text-primary d-flex align-items-center" href="chat.html">
          <i class="bi bi-chat-dots-fill me-3"></i> Chat
        </a>
      </li>
      <li class="nav-item mb-3">
        <a class="nav-link text-dark d-flex align-items-center" href="resources.html">
          <i class="bi bi-journal-bookmark-fill me-3"></i> Resources
        </a>
      </li>
      <li class="nav-item mb-3">
        <a class="nav-link text-dark d-flex align-items-center" href="profile.html">
          <i class="bi bi-person-circle me-3"></i> Profile
        </a>
      </li>
    </ul>
    
    <div class="mt-5 pt-4 border-top">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <small class="text-muted">Therapist Status</small>
        <span class="badge bg-success rounded-pill">Online</span>
      </div>
      <div class="d-flex align-items-center">
        <div class="rounded-circle bg-light p-2 me-2">
          <i class="bi bi-robot text-primary"></i>
        </div>
        <div>
          <small class="fw-bold">AI Therapist</small>
          <div class="d-flex">
            <div class="online-dot"></div>
            <small class="text-muted ms-1">Ready to help</small>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Enhanced Chat Area -->
  <div class="container-fluid p-4">
    <div class="row">
      <div class="col-12">
        <div class="card shadow-lg border-0 overflow-hidden">
          <div class="chat-header d-flex align-items-center">
            <div class="rounded-circle bg-white p-2 me-3">
              <i class="bi bi-robot text-primary fs-5"></i>
            </div>
            <div>
              <h5 class="mb-0">AI Therapist</h5>
              <small class="opacity-75">Always here to listen and support</small>
            </div>
            <div class="ms-auto">
              <button class="btn btn-light btn-sm me-2" onclick="clearChat()">
                <i class="bi bi-trash"></i> Clear
              </button>
              <button class="btn btn-light btn-sm" onclick="exportChat()">
                <i class="bi bi-download"></i> Export
              </button>
            </div>
          </div>
          
          <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
              <!-- Messages will be loaded here -->
              <div class="message ai-message">
                <div class="d-flex align-items-center mb-2">
                  <span class="ai-indicator me-2">
                    <i class="bi bi-robot me-1"></i> AI Therapist
                  </span>
                  <small class="text-muted">Just now</small>
                </div>
                Hello! I'm your AI therapist. I'm here to provide a safe, confidential space for you to share your thoughts and feelings. How can I support you today?
              </div>
              
              <div class="typing-indicator" id="typingIndicator">
                <div class="typing-dots">
                  <span></span>
                  <span></span>
                  <span></span>
                </div>
              </div>
            </div>
            
            <div class="chat-input-container">
              <div class="quick-responses">
                <button class="quick-response-btn" onclick="quickResponse('I\'m feeling anxious today')">
                  ðŸ˜° I'm feeling anxious
                </button>
                <button class="quick-response-btn" onclick="quickResponse('I need help with stress management')">
                  ðŸ§˜ Stress help
                </button>
                <button class="quick-response-btn" onclick="quickResponse('I\'m having trouble sleeping')">
                  ðŸ˜´ Sleep issues
                </button>
                <button class="quick-response-btn" onclick="quickResponse('Can you suggest some coping strategies?')">
                  ðŸ’¡ Coping strategies
                </button>
              </div>
              
              <div class="input-group">
                <input type="text" 
                       class="form-control message-input" 
                       id="messageInput"
                       placeholder="Type your message here... (Press Enter to send)"
                       onkeypress="handleKeyPress(event)">
                <button class="btn send-btn ms-2" onclick="sendMessage()">
                  <i class="bi bi-send text-white"></i>
                </button>
              </div>
              
              <div class="d-flex justify-content-between mt-3">
                <small class="text-muted">
                  <i class="bi bi-shield-check me-1"></i> All conversations are private and secure
                </small>
                <small class="text-muted">
                  <span id="messageCount">0</span> messages today
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Audio for notifications -->
<audio id="messageSound" src="https://assets.mixkit.co/sfx/preview/mixkit-correct-answer-tone-2870.mp3" preload="auto"></audio>

<script>
  let messageCount = 0;
  const messageSound = document.getElementById('messageSound');
  
  // Load saved messages from localStorage
  function loadMessages() {
    const saved = localStorage.getItem('chatMessages');
    if (saved) {
      try {
        const messages = JSON.parse(saved);
        messages.forEach(msg => addMessage(msg.text, msg.type, msg.time, false));
      } catch (e) {
        console.error('Error loading messages:', e);
      }
    }
    updateMessageCount();
  }
  
  // Save messages to localStorage
  function saveMessage(text, type) {
    const saved = localStorage.getItem('chatMessages') || '[]';
    const messages = JSON.parse(saved);
    messages.push({
      text,
      type,
      time: new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' })
    });
    localStorage.setItem('chatMessages', JSON.stringify(messages.slice(-50))); // Keep last 50 messages
  }
  
  // Add message to chat
  function addMessage(text, type = 'user', time = null, save = true) {
    const messagesDiv = document.getElementById('chatMessages');
    const typingIndicator = document.getElementById('typingIndicator');
    
    if (typingIndicator.style.display === 'block') {
      typingIndicator.style.display = 'none';
    }
    
    if (!time) {
      time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
    }
    
    const messageDiv = document.createElement('div');
    messageDiv.className = `message ${type === 'user' ? 'user-message' : 'ai-message'}`;
    
    if (type === 'ai') {
      messageDiv.innerHTML = `
        <div class="d-flex align-items-center mb-2">
          <span class="ai-indicator me-2">
            <i class="bi bi-robot me-1"></i> AI Therapist
          </span>
          <small class="text-muted">${time}</small>
        </div>
        ${text}
      `;
    } else {
      messageDiv.innerHTML = `
        <div class="d-flex justify-content-between align-items-center mb-2">
          <small class="text-white opacity-75">You</small>
          <small class="text-white opacity-75">${time}</small>
        </div>
        ${text}
      `;
    }
    
    messagesDiv.appendChild(messageDiv);
    messagesDiv.scrollTop = messagesDiv.scrollHeight;
    
    if (save) {
      saveMessage(text, type);
    }
    
    if (type === 'user') {
      messageCount++;
      updateMessageCount();
      simulateAIResponse(text);
    }
    
    // Play sound for incoming messages
    if (type === 'ai') {
      messageSound.currentTime = 0;
      messageSound.play().catch(e => console.log("Audio play failed:", e));
    }
  }
  
  // Simulate AI response
  function simulateAIResponse(userMessage) {
    const typingIndicator = document.getElementById('typingIndicator');
    typingIndicator.style.display = 'block';
    
    // Simple response logic based on keywords
    const responses = [
      "I understand. Can you tell me more about how you're feeling?",
      "Thank you for sharing that. It's important to acknowledge these feelings.",
      "I hear you. Let's explore some coping strategies together.",
      "That sounds challenging. Remember, it's okay to feel this way.",
      "Would you like to try some breathing exercises together?",
      "Let me suggest a helpful resource for this situation."
    ];
    
    // Keyword-based responses
    if (userMessage.toLowerCase().includes('anxious')) {
      responses.unshift("Anxiety can be overwhelming. Let's practice some grounding techniques together.");
    }
    if (userMessage.toLowerCase().includes('stress')) {
      responses.unshift("Stress management is important. Have you tried mindfulness exercises?");
    }
    if (userMessage.toLowerCase().includes('sleep')) {
      responses.unshift("Sleep issues are common. Establishing a bedtime routine can help.");
    }
    if (userMessage.toLowerCase().includes('sad')) {
      responses.unshift("I'm here for you. It's okay to feel sad sometimes. Would you like to talk about what's bothering you?");
    }
    
    setTimeout(() => {
      const randomResponse = responses[Math.floor(Math.random() * responses.length)];
      addMessage(randomResponse, 'ai');
    }, 1500 + Math.random() * 2000);
  }
  
  // Send message
  function sendMessage() {
    const input = document.getElementById('messageInput');
    const text = input.value.trim();
    
    if (text) {
      addMessage(text, 'user');
      input.value = '';
    }
  }
  
  // Quick response buttons
  function quickResponse(text) {
    addMessage(text, 'user');
  }
  
  // Handle Enter key
  function handleKeyPress(event) {
    if (event.key === 'Enter' && !event.shiftKey) {
      event.preventDefault();
      sendMessage();
    }
  }
  
  // Clear chat
  function clearChat() {
    if (confirm('Are you sure you want to clear the chat history?')) {
      localStorage.removeItem('chatMessages');
      document.getElementById('chatMessages').innerHTML = `
        <div class="message ai-message">
          <div class="d-flex align-items-center mb-2">
            <span class="ai-indicator me-2">
              <i class="bi bi-robot me-1"></i> AI Therapist
            </span>
            <small class="text-muted">Just now</small>
          </div>
          Hello! I'm your AI therapist. I'm here to provide a safe, confidential space for you to share your thoughts and feelings. How can I support you today?
        </div>
      `;
      messageCount = 0;
      updateMessageCount();
    }
  }
  
  // Export chat
  function exportChat() {
    const messages = document.getElementById('chatMessages').innerText;
    const blob = new Blob([messages], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'MindEase-Chat-' + new Date().toISOString().split('T')[0] + '.txt';
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
  
  // Update message count
  function updateMessageCount() {
    document.getElementById('messageCount').textContent = messageCount;
  }
  
  // Load messages when page loads
  document.addEventListener('DOMContentLoaded', function() {
    loadMessages();
    
    // Load mood from localStorage
    const savedMood = localStorage.getItem('currentMood') || 'ðŸ˜Š Feeling Good';
    const [emoji, ...text] = savedMood.split(' ');
    document.getElementById('currentMoodEmoji').textContent = emoji;
    document.getElementById('currentMoodText').textContent = text.join(' ');
  });
</script>

</body>
</html>